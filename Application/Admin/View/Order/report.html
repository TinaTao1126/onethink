<extend name="Public/base" />

<block name="body">
	<link href="__STATIC__/bootstrap/css/bootstrap.css" rel="stylesheet">
	<!-- 标题栏 -->
	<div class="main-title">
		<h2>{$meta_title}</h2>
	</div>
	
    <form class="form-inline" method="post" action="{:U('history')}" role="form">
    <div class="container">
    	<div class="row">
    		<div class="form-group">
    			<select class="form-control" name="district_id">
                	<option value="0">大区</option>
                	<notempty name="_district">
						<volist name="_district" id="vo" >
							<if condition="$vo.id eq $_condition['_district_id']">
								<option value="{$vo.id}" selected>{$vo.name}</option>
							<else/>
								<option value="{$vo.id}">{$vo.name}</option>
							</if>
						</volist>
					</notempty>
                </select>
                <select class="form-control" name="city_id">
                	<option value="0">城市</option>
                	<notempty name="_city">
						<volist name="_city" id="vo" >
							<if condition="$vo.id eq $_condition['_city_id']">
								<option value="{$vo.id}" selected>{$vo.name}</option>
							<else/>
								<option value="{$vo.id}">{$vo.name}</option>
							</if>
						</volist>
					</notempty>
                </select>
                <select class="form-control" name="store_id">
                	<option value="0">门店</option>
                	<notempty name="_store">
						<volist name="_store" id="vo" >
							<if condition="$vo.id eq $_condition['_store_id']">
								<option value="{$vo.id}" selected>{$vo.name}</option>
							<else/>
								<option value="{$vo.id}">{$vo.name}</option>
							</if>
						</volist>
					</notempty>
                </select>
                <div class="form-group">
                <div class='input-group date' id='startTime'>
                    <input type='text' class="form-control" name="start_time" placeholder="开始时间" value="{$condition._start_time}"/>
                    <!--  -->
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar" ></span>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <div class='input-group date' id='endTime'>
                    <input type='text' class="form-control" name="end_time" placeholder="结束时间" value="{$condition._end_time}"/>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
            </div>
                <button type="submit" class="btn btn-link"><i class="btn-search"></i></button>
    			<a class="sch-btn" href="javascript:;" id="search" url="{:U('index')}"></a>
    		</div>
    	</div>
    </div>
    </form>
    
    <div class="container">
    
    	
    	<div class="row">
    	<div class="col-sm-10">
    		
    		<div id="line" style="height:400px;">
    	
    		</div>
    	</div>
    	</div>
    	<div id="pie">
    	
    	</div>
    </div>
</block>

<block name="script">
	<script src="__STATIC__/echarts/echarts.js"></script>
	<script src="__STATIC__/bootstrap/js/bootstrap.min.js"></script>
	<script src="__STATIC__/bootstrap/js/moment.js"></script>
	<script src="__STATIC__/bootstrap/js/bootstrap-datetimepicker.min.js"></script>
	<script src="__STATIC__/thinkbox/jquery.thinkbox.js"></script>
	<script type="text/javascript" src="__STATIC__/js/district.js"></script>
	<script type="text/javascript">
	//搜索功能
	$("#search").click(function(){
		var url = $(this).attr('url');
        var query  = $('.search-form').find('select').serialize();
        query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g,'');
        query = query.replace(/^&/g,'');
        if( url.indexOf('?')>0 ){
            url += '&' + query;
        }else{
            url += '?' + query;
        }
		window.location.href = url;
	});
	//回车搜索
	$(".search-input").keyup(function(e){
		if(e.keyCode === 13){
			$("#search").click();
			return false;
		}
	});
	
	$(function(){
		$('input[name=start_time]').datetimepicker({
			format: 'YYYY-MM-DD',
		});
		$('input[name=end_time]').datetimepicker({
			format: 'YYYY-MM-DD',
		});
	
        
        var lineChart = echarts.init(document.getElementById('line'));
        
        lineChart.setOption({
            title: {
                text: '异步数据加载示例'
            },
            tooltip: {},
           
            xAxis: {
                data: []
            },
            yAxis: {},
            
        });
        
        $.post("{:U('report')}").done(function (response) {
        	
        	var data = response.info;
        	console.log(data.xAxis);
        	console.log(data.legend);
        	console.log(data.series);
        	
        	var option = {
        		    title: {
        		        text: '折线图堆叠'
        		    },
        		    tooltip: {
        		        trigger: 'axis'
        		    },
        		    legend: {
        		        data: data.legend
        		    },
        		    grid: {
        		        left: '3%',
        		        right: '4%',
        		        bottom: '3%',
        		        containLabel: true
        		    },
        		    toolbox: {
        		        feature: {
        		            saveAsImage: {}
        		        }
        		    },
        		    xAxis: {
        		        type: 'category',
        		        boundaryGap: false,
        		        data: data.xAxis
        		    },
        		    yAxis: {
        		        type: 'value'
        		    },
        		    series: data.series
//         		    [
//         		        {
//         		            name:'订单总数',
//         		            type:'line',
//         		            stack: '总量',
//         		            data:[2,32]
//         		        }
//         		    ]
        		};

            // 填入数据
            lineChart.setOption(option);
            
            //lineChart.setOption(option);
        });
        
        
//         option = {
//         	    title: {
//         	        text: '折线图堆叠'
//         	    },
//         	    tooltip: {
//         	        trigger: 'axis'
//         	    },
//         	    legend: {
//         	        data:{$data['legend']}
//         	    },
//         	    grid: {
//         	        left: '3%',
//         	        right: '4%',
//         	        bottom: '3%',
//         	        containLabel: true
//         	    },
//         	    toolbox: {
//         	        feature: {
//         	            saveAsImage: {}
//         	        }
//         	    },
//         	    xAxis: {
//         	        type: 'category',
//         	        boundaryGap: false,
//         	        data: {$data['xAxis']}
//         	    },
//         	    yAxis: {
//         	        type: 'value'
//         	    },
//         	    series: {$data.series}
//         	};
        
       
	});
	
    //导航高亮
    highlight_subnav('{:U('Order/report')}');
	</script>
</block>
